#include <GUC_dogl128.h>


#if GUC_DOG_CFG_FONT_COMPILE_DEFAULT == 1
code const unsigned char __gucdog_default_font[]=
{//95 5x8 Char
   
   5, //Size in X of a char
   
   32, //Zero(offset)
   95, //Size in number of char
   
   0x00,0x00, //Space
   0x00,0x00,
   0x00,
   0x00,0x00, //!
   0x9E,0x00,
   0x00,
   0x00,0x0E, //"
   0x00,0x0E,
   0x00,
   0x28,0xFE, //#
   0x28,0xFE,
   0x28,
   0x48,0x54, //$
   0xFE,0x54,
   0x24,
   0x46,0x26, //%
   0x10,0xC8,
   0xC4,
   0x6C,0x92, //&
   0xAA,0x44,
   0xA0,
   0x00,0x0A, //'
   0x06,0x00,
   0x00,
   0x00,0x38, //(
   0x44,0x82,
   0x00,
   0x00,0x82, //)
   0x44,0x38,
   0x00,
   0x28,0x10, //*
   0x7C,0x10,
   0x28,
   0x10,0x10, //+
   0x7C,0x10,
   0x10,
   0x00,0xA0, //,
   0x60,0x00,
   0x00,
   0x10,0x10, //-
   0x10,0x10,
   0x10,
   0x00,0xC0, //.
   0xC0,0x00,
   0x00,
   0x40,0x20, ///
   0x10,0x08,
   0x04,
   
   0x7C,0xA2, //0
   0x92,0x8A,
   0x7C,
   0x80,0x84, //1
   0xFE,0x80,
   0x80,
   0x84,0xC2, //2
   0xA2,0x92,
   0x8C,
   0x42,0x82, //3
   0x8A,0x96,
   0x62,
   0x30,0x28, //4
   0x24,0xFE,
   0x20,
   0x8E,0x8A, //5
   0x8A,0x8A,
   0x72,
   0x78,0x94, //6
   0x92,0x92,
   0x70,
   0x02,0xE2, //7
   0x12,0x0A,
   0x06,
   0x6C,0x92, //8
   0x92,0x92,
   0x6C,
   0x0C,0x92, //9
   0x92,0x52,
   0x3C,
   
   0x00,0x6C, //:
   0x6C,0x00,
   0x00,
   0x00,0xAC, //;
   0x6C,0x00,
   0x00,
   0x10,0x28, //<
   0x44,0x82,
   0x00,
   0x28,0x28, //=
   0x28,0x28,
   0x28,
   0x00,0x82, //>
   0x44,0x28,
   0x10,
   0x04,0x02, //?
   0xA2,0x12,
   0x0C,
   0x64,0x92, //@
   0xF2,0x82,
   0x7C,
   
   0xFC,0x22, //A
   0x22,0x22,
   0xFC,
   0xFE,0x92, //B
   0x92,0x92,
   0x6C,
   0x7C,0x82, //C
   0x82,0x82,
   0x44,
   0xFE,0x82, //D
   0x82,0x44,
   0x38,
   0xFE,0x92, //E
   0x92,0x92,
   0x82,
   0xFE,0x12, //F
   0x12,0x12,
   0x02,
   0x7C,0x82, //G
   0x92,0x92,
   0xF4,
   0xFE,0x10, //H
   0x10,0x10,
   0xFE,
   0x82,0x82, //I
   0xFE,0x82,
   0x82,
   0x40,0x80, //J
   0x82,0x7E,
   0x02,
   0xFE,0x10, //K
   0x28,0x44,
   0x82,
   0xFE,0x80, //L
   0x80,0x80,
   0x80,
   0xFE,0x04, //M
   0x18,0x04,
   0xFE,
   0xFE,0x08, //N
   0x10,0x20,
   0xFE,
   0x7C,0x82, //O
   0x82,0x82,
   0x7C,
   0xFE,0x12, //P
   0x12,0x12,
   0x0C,
   0x7C,0x82, //Q
   0xA2,0x42,
   0xBC,
   0xFE,0x12, //R
   0x32,0x52,
   0x8C,
   0x8C,0x92, //S
   0x92,0x92,
   0x62,
   0x02,0x02, //T
   0xFE,0x02,
   0x02,
   0x7E,0x80, //U
   0x80,0x80,
   0x7E,
   0x3E,0x40, //V
   0x80,0x40,
   0x3E,
   0x7E,0x80, //W
   0x70,0x80,
   0x7E,
   0xC6,0x28, //X
   0x10,0x28,
   0xC6,
   0x0E,0x10, //Y
   0xE0,0x10,
   0x0E,
   0xC2,0xA2, //Z
   0x92,0x8A,
   0x86,

   0x00,0xFE, //[
   0x82,0x82,
   0x00,
   0x04,0x08, //'\'
   0x10,0x20,
   0x40,
   0x00,0x82, //]
   0x82,0xFE,
   0x00,
   0x08,0x04, //^
   0x02,0x04,
   0x08,
   0x80,0x80, //_
   0x80,0x80,
   0x80,
   0x00,0x02, //`
   0x04,0x08,
   0x00,
   
   0x40,0xA8, //a
   0xA8,0xA8,
   0xF0,
   0xFE,0x90, //b
   0x88,0x88,
   0x70,
   0x70,0x88, //c
   0x88,0x88,
   0x40,
   0x70,0x88, //d
   0x88,0x90,
   0xFE,
   0x70,0xA8, //e
   0xA8,0xA8,
   0x30,
   0x10,0xFC, //f
   0x12,0x02,
   0x04,
   0x18,0xA4, //g
   0xA4,0xA4,
   0x7C,
   0xFE,0x10, //h
   0x08,0x08,
   0xF0,
   0x00,0x88, //i
   0xFA,0x80,
   0x00,
   0x40,0x80, //j
   0x80,0x7A,
   0x00,
   0xFE,0x20, //k
   0x50,0x88,
   0x00,
   0x00,0x82, //l
   0xFE,0x80,
   0x00,
   0xF8,0x08, //m
   0x30,0x08,
   0xF0,
   0xF8,0x10, //n
   0x08,0x08,
   0xF0,
   0x70,0x88, //o
   0x88,0x88,
   0x70,
   0xF8,0x28, //p
   0x28,0x28,
   0x10,
   0x10,0x28, //q
   0x28,0x30,
   0xF8,
   0xF8,0x10, //r
   0x08,0x08,
   0x10,
   0x90,0xA8, //s
   0xA8,0xA8,
   0x40,
   0x08,0x7E, //t
   0x88,0x80,
   0x40,
   0x78,0x80, //u
   0x80,0x40,
   0xF8,
   0x38,0x40, //v
   0x80,0x40,
   0x38,
   0x78,0x80, //w
   0x60,0x80,
   0x78,
   0x88,0x50, //x
   0x20,0x50,
   0x88,
   0x18,0xA0, //y
   0xA0,0xA0,
   0x78,
   0x88,0xC8, //z
   0xA8,0x98,
   0x88,

   0x00,0x10, //{
   0x6C,0x82,
   0x00,
   0x00,0x00, //|
   0xFE,0x00,
   0x00,
   0x00,0x82, //}
   0x6C,0x10,
   0x00,
   0x10,0x08, //~
   0x10,0x20,
   0x10,
   0x00,0x00, //¦
   0xEE,0x00,
   0x00
};
xdata unsigned char* __gucdog_font_data=__gucdog_default_font;
#else
xdata unsigned char* __gucdog_font_data;
#endif //GUC_DOG_CFG_FONT_COMPILE_DEFAULT

void GUC_dog_init()
{
   GUC_DOG_CS = 1;
   GUC_DOG_CS = 0;
   #if GUC_DOG_CFG_OUTPUT == GUC_DOG_CFG_OUTPUT_SPISIMULATE
      GUC_DOG_SCLK = 0;
   #endif //GUC_DOG_CFG_OUTPUT_SPISIMULATE
   
   GUC_dog_sendByte(0x40, 0); //Display start line 0
   GUC_dog_sendByte(0xA1, 0); //ADC reverse *)
   GUC_dog_sendByte(0xC0, 0); //Normal COM0~COM63
   GUC_dog_sendByte(0xA6, 0); //Display normal
   GUC_dog_sendByte(0xA2, 0); //Set bias 1/9 (Duty 1/65)
   GUC_dog_sendByte(0x2F, 0); //Booster, Regulator and Follower on
   GUC_dog_sendByte(0xF8, 0); //Set internal Booster to 4x
   GUC_dog_sendByte(0x00, 0); //Set internal Booster to 4x
   GUC_dog_sendByte(0x27, 0); //V0 voltage regulator set
   GUC_dog_sendByte(0x81, 0); //Contrast set
   GUC_dog_sendByte(0x10, 0); //Contrast set
   GUC_dog_sendByte(0xAC, 0); //No indicator
   GUC_dog_sendByte(0x00, 0); //No indicator
   GUC_dog_sendByte(0xAF, 0); //Display on

   GUC_dog_sendByte(0xB0, 0); //Page 0
}

#if GUC_DOG_CFG_OUTPUT == GUC_DOG_CFG_OUTPUT_SPI3WIRE
void GUC_dog_sendByte(const unsigned char _byte, bit _a0)
{
   GUC_DOG_A0 = _a0;

   SPIF = 0;
   SPI0DAT = _byte;
   while (!SPIF);
   SPIF = 0;
}
#endif //GUC_DOG_CFG_OUTPUT_SPI3WIRE

#if GUC_DOG_CFG_OUTPUT == GUC_DOG_CFG_OUTPUT_SPISIMULATE
void GUC_dog_sendByte(const unsigned char _byte, bit _a0)
{
   unsigned char i;

   GUC_DOG_A0 = _a0;

   for (i=0; i<8; ++i)
   {
      GUC_DOG_MOSI = _byte&(0x80>>i);
      GUC_DOG_SCLK = 1;
      GUC_DOG_SCLK = 0;
   }
}
#endif //GUC_DOG_CFG_OUTPUT_SPISIMULATE

void GUC_dog_setCursorPos(const unsigned char _page, const unsigned char _row)
{
   GUC_dog_sendByte(0xB0|(_page&0x0F), 0); //Set page X
   GUC_dog_sendByte(0x00|(_row&0x0F), 0); //Least significant address
   GUC_dog_sendByte(0x10|(_row>>4), 0); //Most significant address
}

void GUC_dog_clearScreen(const unsigned char _value)
{
   unsigned char page, row;

   for (page=0; page<8; ++page)
   {
      GUC_dog_sendByte(0xB0|page, 0); //Set page X
      GUC_dog_sendByte(0x00, 0); //Least significant address
      GUC_dog_sendByte(0x10, 0); //Most significant address
      for (row=0; row<128; ++row)
      {
         GUC_dog_sendByte(_value, 1); //Write
      }
   }
}

void GUC_dog_charWrite(unsigned char _valueChar, const unsigned char _invert)
{//GUC_DOG_CFG_FONT_CUSTOMISABLE_SIZE
   unsigned char x;
   unsigned short addressValue;
   
   _valueChar -= __gucdog_font_data[_GUC_DOG_FONT_ZERO];
   
   if ( _valueChar >= __gucdog_font_data[_GUC_DOG_FONT_SIZE] )
   {
      return;
   }
   
   #if GUC_DOG_CFG_FONT_CUSTOMISABLE_SIZE == 1
   addressValue = _valueChar*__gucdog_font_data[_GUC_DOG_FONT_X] + _GUC_DOG_FONT_HEADER_SIZE;
   #else
   addressValue = _valueChar*_GUC_DOG_FONT_DEFAULT_SIZEX + _GUC_DOG_FONT_HEADER_SIZE;
   #endif //GUC_DOG_CFG_FONT_CUSTOMISABLE_SIZE
   
   
   #if GUC_DOG_CFG_FONT_CUSTOMISABLE_SIZE == 1
   for (x=0; x<__gucdog_font_data[_GUC_DOG_FONT_X]; ++x)
   #else
   for (x=0; x<_GUC_DOG_FONT_DEFAULT_SIZEX; ++x)
   #endif //GUC_DOG_CFG_FONT_CUSTOMISABLE_SIZE
   {
      GUC_dog_sendByte(__gucdog_font_data[addressValue++] ^ _invert, 1); //Write
   }

   GUC_dog_sendByte(_invert, 1); //Write
}

void GUC_dog_stringWrite(const unsigned char* _str, const unsigned char _invert)
{
   while ( *_str )
   {
      GUC_dog_charWrite( *(_str++), _invert);
   }
}
void GUC_dog_pstringWrite(const unsigned char* _str, const unsigned char _invert)
{
   unsigned char i;
   for (i=1; i<_str[0]; ++i)
   {
      GUC_dog_charWrite( _str[i], _invert);
   }
}